{% extends "base.html" %}

{% block content %}
<div class="matches-container">
    <h2 class="fade">Пользователи с похожими интересами</h2>
    {% if matches %}
        <ul class="matches-list fade">
        {% for match in matches %}
            <li>
                <strong>{{ match.name }}</strong>: Общие интересы - {{ match.common_interests }}
                <button 
                    class="chat-btn" 
                    onclick="startChat({{ current_user_id }}, {{ match.id }})">
                    Начать чат
                </button>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>К сожалению, мы не нашли пользователей с общими интересами.</p>
    {% endif %}
</div>

<script>
    function startChat(user_1_id, user_2_id) {
        console.log("Старт чата для:", user_1_id, user_2_id); // Отладка
        fetch("{{ url_for('start_chat') }}", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ user_1_id: user1_id, user_2_id: user2_id }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.chat_id) {
                console.log("Чат создан, ID:", data.chat_id); // Отладка
                window.location.href = `/chat/${data.chat_id}`; // Перенаправление в чат
            } else {
                console.error("Ошибка создания чата:", data);
                alert("Не удалось создать чат. Попробуйте позже.");
            }
        })
        .catch(error => {
            console.error("Ошибка отправки запроса:", error);
            alert("Произошла ошибка. Проверьте подключение к серверу.");
        });
    }
</script>
{% endblock %}
