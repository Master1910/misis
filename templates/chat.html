{% extends "base.html" %}
{% block content %}
<div class="chat-container">
    <h2>Чат с {{ target_user }}</h2>
    <div class="chat-history">
        {% for sender_id, message, timestamp in messages %}
            <p><strong>{{ sender_id }}:</strong> {{ message }} <em>({{ timestamp }})</em></p>
        {% endfor %}
    </div>
    <form id="chat-form">
        <input type="text" id="message" placeholder="Введите сообщение" required>
        <button type="submit">Отправить</button>
    </form>
</div>
<script src="{{ url_for('static', filename='scripts.js') }}"></script>
<script>
    const socket = io.connect();
    const form = document.getElementById('chat-form');
    const messageInput = document.getElementById('message');
    
    form.onsubmit = function(e) {
        e.preventDefault();
        const message = messageInput.value;
        socket.emit('send_message', {receiver: "{{ target_user }}", message: message});
        messageInput.value = '';
    };

    socket.on('receive_message', function(data) {
        const chatHistory = document.querySelector('.chat-history');
        chatHistory.innerHTML += `<p><strong>${data.sender}:</strong> ${data.message}</p>`;
    });
</script>
{% endblock %}
